<!DOCTYPE html>
<html>
<head>
    <title>Item Table View</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        .icon-cell {
            width: 30px;
        }

        .icon-img {
            width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <nav>
        <a href="index.html" class="btn btn-primary">Back to main menu</a>
        <button id="viewSelectedButton" class="btn btn-primary">View selected items</button>
        <button id="resetButton" class="btn btn-secondary">Reset</button>
    </nav>
    <br>
    <h1>Item Table View</h1>
    <table id="itemTable" class="table">
        <thead>
            <tr>
                <!--<th class="icon-cell"></th>
                <th>Item Code</th>
                <th>Tag</th>
                <th>Description</th>
                <th>Price</th> -->
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="items.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            fetch('items.csv')
                .then(response => response.text())
                .then(csvData => {
                    const lines = csvData.split(/\r?\n/);
                    const tableBody = document.querySelector('#itemTable tbody');
                    const selectedItems = [];

                    lines.forEach(line => {
                        const data = line.split(',');
                        const itemCode = data[0];
                        const tag = data[1];
                        const description = data[2];
                        const prices = data.slice(3);
                        const iconPath = `Icons/${itemCode}.jpg`;

                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="icon-cell"><img class="icon-img" src="${iconPath}" alt="Icon"></td>
                            <td>${itemCode}</td>
                            <td>${tag}</td>
                            <td>${description}</td>
                            <td>${prices[0]}</td>
                            <td>${prices[1]}</td>
                            <td>${prices[2]}</td>
                            <td>${prices[3]}</td>
                            <td>${prices[4]}</td>
                        `;

                        const tickCell = document.createElement('td');
                        const tickCheckbox = document.createElement('input');
                        tickCheckbox.type = 'checkbox';
                        tickCheckbox.addEventListener('change', function() {
                            if (tickCheckbox.checked) {
                                selectedItems.push({
                                    itemCode: itemCode,
                                    tag: tag,
                                    description: description,
                                    prices: prices
                                });
                            } else {
                                const index = selectedItems.findIndex(item => item.itemCode === itemCode);
                                if (index !== -1) {
                                    selectedItems.splice(index, 1);
                                }
                            }
                        });
                        tickCell.appendChild(tickCheckbox);
                        row.insertBefore(tickCell, row.firstChild);

                        tableBody.appendChild(row);
                    });

                    // Handle view selected items button
                    const viewSelectedButton = document.querySelector('#viewSelectedButton');
                    viewSelectedButton.addEventListener('click', function() {
                        openNewPage(selectedItems);
                    });

                    // Handle reset button
                    const resetButton = document.querySelector('#resetButton');
                    resetButton.addEventListener('click', function() {
                        selectedItems.length = 0; // Clear the selected items array
                        const checkboxes = document.querySelectorAll('#itemTable tbody input[type="checkbox"]');
                        checkboxes.forEach(checkbox => {
                            checkbox.checked = false; // Uncheck all checkboxes
                        });
                    });
                })
                .catch(error => {
                    console.error('Error fetching the CSV file:', error);
                });
        });

        function openNewPage(selectedItems) {
            // Serialize the selectedItems array and pass it to the new page
            const serializedItems = JSON.stringify(selectedItems);
            sessionStorage.setItem('selectedItems', serializedItems);

            // Open the new page in a new window/tab
            window.open('newPage.html', '_blank');
        }
    </script>
</body>
</html>
