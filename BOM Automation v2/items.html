<!DOCTYPE html>
<html>
<head>
    <title>Item Table View</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        .icon-cell {
            width: 1px;
        }

        .icon-img {
            width: 80%;
            height: auto;
        }

        table {
            width: 50%;
            border-collapse: collapse;
        }

        th, td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }

        tbody tr:hover {
            background-color: #f5f5f5;
        }

        .highlighted {
            background-color: #c1e7f4;
        }

        .checkbox-cell {
            width: 20px;
        }

        .status-cell {
            width: 1px;
        }
    </style>
</head>
<body>
    <nav>
        <a href="designExtract.html" class="btn btn-primary">Insert Design</a>
        <a href="newPage.html" class="btn btn-primary">View BOM</a>
        <button id="resetButton" class="btn btn-secondary">Reset</button>
    </nav>
    <br>
    <h1>Item Table View</h1>
    <table id="itemTable" class="table">
        <thead>
            <tr>
                <th class="icon-cell">checkbox</th>
                <th class="status-cell">Icon</th>
                <th>Selected</th>
                <th>Item Code</th>
                <th>Tag</th>
                <th>Description</th>
                <th>Ex. Works Price</th>
                <th>CIF</th>
                <th>Duty Free</th>
                <th>Duty Paid</th>
                <th>Export</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            fetch('items.csv')
                .then(response => response.text())
                .then(csvData => {
                    const lines = csvData.split(/\r?\n/);
                    const tableBody = document.querySelector('#itemTable tbody');
                    const selectedItems = [];

                    lines.forEach(line => {
                        const data = line.split(',');
                        const itemCode = data[1];
                        const tag = data[2];
                        const description = data[3];
                        const exWorksPrice = data[4];
                        const cif = data[5];
                        const dutyFree = data[6];
                        const dutyPaid = data[7];
                        const exportPrice = data[8];
                        const iconPath = `Icons/${itemCode}.jpg`;

                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="icon-cell"><img class="icon-img" src="${iconPath}" alt="Icon"></td>
                            <td class="status-cell"></td>
                            <td>${itemCode}</td>
                            <td>${tag}</td>
                            <td>${description}</td>
                            <td>${exWorksPrice}</td>
                            <td>${cif}</td>
                            <td>${dutyFree}</td>
                            <td>${dutyPaid}</td>
                            <td>${exportPrice}</td>
                        `;

                        const tickCell = document.createElement('td');
                        const tickCheckbox = document.createElement('input');
                        tickCheckbox.type = 'checkbox';
                        tickCheckbox.addEventListener('change', function() {
                            const statusCell = row.querySelector('.status-cell');
                            statusCell.textContent = tickCheckbox.checked ? 'Yes' : 'No';

                            if (tickCheckbox.checked) {
                                selectedItems.push(itemCode);
                                row.classList.add('highlighted');
                            } else {
                                const index = selectedItems.indexOf(itemCode);
                                if (index !== -1) {
                                    selectedItems.splice(index, 1);
                                }
                                row.classList.remove('highlighted');
                            }
                        });
                        tickCell.classList.add('checkbox-cell');
                        tickCell.appendChild(tickCheckbox);
                        row.insertBefore(tickCell, row.firstChild);

                        tableBody.appendChild(row);
                    });

                    // Handle reset button
                    const resetButton = document.querySelector('#resetButton');
                    resetButton.addEventListener('click', function() {
                        selectedItems.length = 0; // Clear the selected items array
                        const checkboxes = document.querySelectorAll('#itemTable tbody input[type="checkbox"]');
                        checkboxes.forEach(checkbox => {
                            checkbox.checked = false; // Uncheck all checkboxes
                        });
                        const statusCells = document.querySelectorAll('#itemTable tbody .status-cell');
                        statusCells.forEach(cell => {
                            cell.textContent = '';
                        });
                        const rows = document.querySelectorAll('#itemTable tbody tr');
                        rows.forEach(row => {
                            row.classList.remove('highlighted');
                        });
                    });
                })
                .catch(error => {
                    console.error('Error fetching the CSV file:', error);
                });
        });
    </script>
</body>
</html>
