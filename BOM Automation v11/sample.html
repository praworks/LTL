<!DOCTYPE html>
<html>
<head>
  <title>Items Table</title>
  <style>
    table {
      border-collapse: collapse;
      width: 100%;
    }
    
    th, td {
      border: 1px solid black;
      padding: 8px;
      text-align: center;
    }
    
    th:nth-child(5),
    th:nth-child(6),
    th:nth-child(7),
    th:nth-child(8),
    th:nth-child(9),
    td:nth-child(5),
    td:nth-child(6),
    td:nth-child(7),
    td:nth-child(8),
    td:nth-child(9) {
      width: 100px;
    }
    
    /* Set width for the icon column */
    th:nth-child(2),
    td:nth-child(2) {
      width: 80px; /* Adjust the width as per your preference */
    }
    
    /* Set width for the Description column */
    th:nth-child(4),
    td:nth-child(4) {
      width: 200px;
    }
    
    /* Style the icons */
    .item-icon {
      display: block;
      max-width: 50px; /* Adjust the maximum width as per your preference */
      height: auto;
      margin: 0 auto; /* Center the icons horizontally */
      transition: max-width 0.3s ease; /* Add transition effect */
    }
    
    /* Enlarge the icons on hover */
    .item-icon:hover {
      max-width: 250px; /* Adjust the maximum width as per your preference */
    }
    
    /* Highlight the selected rows */
    .selected {
      background-color: blanchedalmond;
    }
  </style>
  <script>
    // Function to fetch the CSV file and generate the table
    function generateTable() {
      var csvFile = 'items.csv';  // Replace with your CSV file path
      
      // Fetch the CSV file
      fetch(csvFile)
        .then(function(response) {
          return response.text();
        })
        .then(function(csvData) {
          // Parse CSV data
          var rows = csvData.split('\n');
          var tableHTML = '<table>';
          
          // Generate the table rows
          for (var i = 0; i < rows.length; i++) {
            var cells = rows[i].split(',');
            tableHTML += '<tr>';
            
            // Add the checkbox column
            var checkboxHtml = '<input type="checkbox" onclick="toggleSelected(this)"';
            if (cells[3].toLowerCase() === 'yes') {
              checkboxHtml += ' checked';
              tableHTML += '<td class="selected">' + checkboxHtml + '</td>';
            } else {
              tableHTML += '<td>' + checkboxHtml + '</td>';
            }
            
            // Add the icon column
            var iconPath = 'icons/' + cells[1] + '.jpg';  // Assuming item code is in the second column
            tableHTML += '<td><img class="item-icon" src="' + iconPath + '"></td>';
            
            // Add the remaining columns
            for (var j = 0; j < cells.length; j++) {
              if (j === 2 || j === 5) {
                // Add input field for the quantity column and kg/l/nos column
                tableHTML += '<td><input type="text" id="cell-' + i + '-' + j + '" value="' + cells[j] + '" oninput="updateCellValue(this)"/></td>';
              } else {
                tableHTML += '<td>' + cells[j] + '</td>';
              }
            }
            
            tableHTML += '</tr>';
          }
          
          tableHTML += '</table>';
          
          // Append the table to the "table-container" div
          document.getElementById('table-container').innerHTML = tableHTML;
        });
    }
    
    // Function to toggle the selected state and highlight the row
    function toggleSelected(checkbox) {
      var row = checkbox.parentNode.parentNode;
      
      if (checkbox.checked) {
        row.classList.add('selected');
      } else {
        row.classList.remove('selected');
      }
    }
    
    // Function to update the cell value
    function updateCellValue(input) {
      var row = input.parentNode.parentNode;
      var rowIndex = row.rowIndex - 1;
      var cellIndex = input.parentNode.cellIndex;
      var newValue = input.value;
      
      // Update the cell value in the table
      row.cells[cellIndex].innerHTML = newValue;
    }
    
    // Function to save the table as CSV
    function saveAsCsv() {
      // Get the table element
      var table = document.getElementById('items-table');
      
      // Initialize the CSV content
      var csvContent = '';
      
      // Iterate over table rows
      for (var i = 0; i < table.rows.length; i++) {
        var row = table.rows[i];
        
        // Iterate over row cells
        for (var j = 0; j < row.cells.length; j++) {
          var cell = row.cells[j];
          
          // Get the cell value
          var value = cell.innerText;
          
          // Add the value to the CSV content
          csvContent += value;
          
          // Add a comma separator between values
          if (j < row.cells.length - 1) {
            csvContent += ',';
          }
        }
        
        // Add a new line separator after each row
        csvContent += '\n';
      }
      
      // Create a Blob object with the CSV content
      var blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      
      // Create a temporary download link and trigger the download
      var link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'items.csv';
      link.style.display = 'none';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
    
    // Generate the table on page load
    window.addEventListener('load', generateTable);
  </script>
</head>
<body>
  <h1>Items Table</h1>
  
  <!-- Button to save the table as CSV -->
  <button onclick="saveAsCsv()">Save as CSV</button>
  
  <!-- Container for the table -->
  <div id="table-container"></div>
</body>
</html>
