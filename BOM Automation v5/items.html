<!DOCTYPE html>
<html>
<head>
  <title>Items Table</title>
  <style>
    table {
      border-collapse: collapse;
      width: 100%;
    }
    
    th, td {
      border: 1px solid black;
      padding: 8px;
      text-align: center;
    }
    
    th:nth-child(5),
    th:nth-child(6),
    th:nth-child(7),
    th:nth-child(8),
    th:nth-child(9),
    td:nth-child(5),
    td:nth-child(6),
    td:nth-child(7),
    td:nth-child(8),
    td:nth-child(9) {
      width: 100px;
    }
    
    /* Set width for the icon column */
    th:nth-child(2),
    td:nth-child(2) {
      width: 80px; /* Adjust the width as per your preference */
    }
    
    /* Set width for the Description column */
    th:nth-child(4),
    td:nth-child(4) {
      width: 200px;
    }
    
    /* Style the icons */
    .item-icon {
      display: block;
      max-width: 50px; /* Adjust the maximum width as per your preference */
      height: auto;
      margin: 0 auto; /* Center the icons horizontally */
      transition: max-width 0.3s ease; /* Add transition effect */
    }
    
    /* Enlarge the icons on hover */
    .item-icon:hover {
      max-width: 250px; /* Adjust the maximum width as per your preference */
    }
    
    /* Highlight the selected rows */
    .selected {
      background-color: yellow;
    }
  </style>
  <script>
    // Function to fetch the CSV file and generate the table
    function generateTable() {
      var csvFile = 'items.csv';  // Replace with your CSV file path
      
      // Fetch the CSV file
      fetch(csvFile)
        .then(function(response) {
          return response.text();
        })
        .then(function(csvData) {
          // Parse CSV data
          var rows = csvData.split('\n');
          var tableHTML = '<table>';
          
          // Generate the table rows
          for (var i = 0; i < rows.length; i++) {
            var cells = rows[i].split(',');
            tableHTML += '<tr>';
            
            // Add the checkbox column
            tableHTML += '<td><input type="checkbox" onclick="toggleSelected(this)"></td>';
            
            // Add the icon column
            var iconPath = 'icons/' + cells[1] + '.jpg';  // Assuming item code is in the second column
            tableHTML += '<td><img class="item-icon" src="' + iconPath + '"></td>';
            
            // Add the remaining columns
            for (var j = 0; j < cells.length; j++) {
              tableHTML += '<td>' + cells[j] + '</td>';
            }
            
            tableHTML += '</tr>';
          }
          
          tableHTML += '</table>';
          
          // Append the table to the "table-container" div
          document.getElementById('table-container').innerHTML = tableHTML;
        });
    }
    
    // Function to toggle the selected state and highlight the row
    function toggleSelected(checkbox) {
      var row = checkbox.parentNode.parentNode;
      
      if (checkbox.checked) {
        row.classList.add('selected');
      } else {
        row.classList.remove('selected');
      }
    }
    
    // Function to display selected items in a new table
    function showSelectedItems() {
      // Get all selected checkboxes
      var checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');

      // Create a new table HTML string for selected items
      var tableHTML = '<table>';

      // Generate the table header
      tableHTML += '<tr>';
      var headers = document.querySelectorAll('th');
      headers.forEach(function(header) {
        tableHTML += '<th>' + header.innerText + '</th>';
      });
      tableHTML += '</tr>';

      // Generate the table rows for selected items
      checkboxes.forEach(function(checkbox) {
        var row = checkbox.parentNode.parentNode;
        tableHTML += '<tr>' + row.innerHTML + '</tr>';  // Append the row HTML
      });

      tableHTML += '</table>';

      // Open a new HTML page with the selected items
      var newWindow = window.open();
      newWindow.document.write(tableHTML);
      newWindow.document.close();
    }

    // Function to download selected items as CSV
    function downloadSelectedItems() {
      // Get all selected checkboxes
      var checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');

      // Create a CSV string for selected items
      var csvContent = '';

      // Generate the CSV header
      var headers = document.querySelectorAll('th');
      headers.forEach(function(header, index) {
        csvContent += '"' + header.innerText + '"';
        if (index < headers.length - 1) {
          csvContent += ',';
        }
      });
      csvContent += '\n';

      // Generate the CSV rows for selected items
      checkboxes.forEach(function(checkbox) {
        var row = checkbox.parentNode.parentNode;
        var cells = row.querySelectorAll('td');
        cells.forEach(function(cell, index) {
          csvContent += '"' + cell.innerText + '"';
          if (index < cells.length - 1) {
            csvContent += ',';
          }
        });
        csvContent += '\n';
      });

      // Create a Blob object with the CSV content
      var blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });

      // Create a temporary download link and trigger the download
      var link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'selected_items.csv';
      link.style.display = 'none';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
    
    // Generate the table on page load
    window.addEventListener('load', generateTable);
  </script>
</head>
<body>
  <h1>Items Table</h1>
  
  <!-- Button to show selected items -->
  <button onclick="showSelectedItems()">Show Selected Items</button>
  
  <!-- Button to download selected items as CSV -->
  <button onclick="downloadSelectedItems()">Download Selected Items</button>
  
  <!-- Container for the table -->
  <div id="table-container"></div>
</body>
</html>
