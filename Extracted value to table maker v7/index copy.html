<!DOCTYPE html>
<html>

<head>
    <title>Extract design sheet as table</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="md-6">
                <h1>Extract design sheet as table</h1>
                <textarea autofocus id="input" rows="5" column="50" placeholder="Paste design here"
                    class="form-control"></textarea><br>

                <button onclick="extract()" class="btn btn-primary">Extract Values</button><br><br>
                <button onclick="copyResults()" class="btn btn-secondary">Copy All Results</button><br><br>
            </div>
            <div class="md-6">
                <table id="output">
                    <thead>
                        <tr>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>


    <script>
        var data = [];

        function extract() {
            var input = document.getElementById("input").value;
            var lines = input.split(/\s*\|\s*|\s*\n\s*/);

            var outputTable = document.getElementById("output");
            outputTable.innerHTML = "";
            data = [];

            var headerRow = outputTable.insertRow();
            headerRow.insertCell().innerHTML = "<b>Field</b>";
            headerRow.insertCell().innerHTML = "<b>Value</b>";
            for (var j = 1; j <= 30; j++) {
                headerRow.insertCell().innerHTML = "<b>Value-" + j + "</b>";
            }

            for (var i = 0; i < lines.length; i++) {
                var colonIndex = lines[i].indexOf(":");
                var kvaIndex = lines[i].toLowerCase().indexOf("kva");

                if (colonIndex >= 0 || kvaIndex >= 0) {
                    var splitIndex = kvaIndex >= 0 ? kvaIndex + 3 : colonIndex;
                    var beforeSplit = lines[i].substring(0, splitIndex).trim();
                    var afterSplit = lines[i].substring(splitIndex + 0).trim();

                    var values = afterSplit.split(/[\/\s,^x-]+|-|:/);

                    var row = outputTable.insertRow();
                    row.insertCell().innerHTML = beforeSplit;
                    row.insertCell().innerHTML = values[0];
                    for (var k = 1; k <= 30; k++) {
                        var value = "";
                        if (k < values.length) {
                            value = values[k];
                        }
                        row.insertCell().innerHTML = value;
                    }
                    data.push([beforeSplit, values.join(",")]);
                }
            }
        }

        function download() {
            var workbook = XLSX.utils.book_new();
            var worksheet = XLSX.utils.aoa_to_sheet(data);
            XLSX.utils.book_append_sheet(workbook, worksheet, "Sheet1");
            var file = XLSX.write(workbook, { bookType: "xlsx", type: "array" });
            saveAs(new Blob([file]), fileName);
        }

        function sortValues() {
            var table = document.getElementById("output");
            var tbody = table.querySelector("tbody");
            var rows = Array.from(tbody.querySelectorAll("tr:not(:first-child)"));

            rows.sort(function (a, b) {
                var aText = a.querySelector("td:first-child").textContent.toLowerCase();
                var bText = b.querySelector("td:first-child").textContent.toLowerCase();
                if (aText < bText) {
                    return -1;
                } else if (aText > bText) {
                    return 1;
                } else {
                    return 0;
                }
            });

            var newTbody = document.createElement("tbody");
            newTbody.appendChild(table.rows[0]);
            rows.forEach(function (row) {
                newTbody.appendChild(row);
            });

            table.replaceChild(newTbody, tbody);
        }

        function copyResults() {
            var table = document.getElementById("output");
            var range = document.createRange();
            range.selectNode(table);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            document.execCommand("copy");
            window.getSelection().removeAllRanges();
        }

    </script>
</body>

</html>
